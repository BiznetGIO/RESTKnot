version: '3'
services:
  restknot-agent:
    image: restknot-agent:0.7.0
    environment:
      - RESTKNOT_AGENT_TYPE=master
      # the libknot.so location is Distro dependant.
      # e.g in CentOS it is `/usr/lib64/libknot.so.10.0.0`
      - RESTKNOT_KNOT_LIB=/usr/lib/x86_64-linux-gnu/libknot.so
      - RESTKNOT_KNOT_SOCKET=/var/run/knot/knot.sock
      # using 127.0.0.1 or localhost won't make it work
      # set it to RESTKNOT API IP
      - RESTKNOT_KAFKA_BROKER=172.17.0.1
      - RESTKNOT_KAFKA_PORTS=9092
      - RESTKNOT_KAFKA_TOPIC=domaindata
      - RESTKNOT_LOG_FILE=/restknot-data/restknot-agent.log
    entrypoint: dnsagent start
    volumes:
        # on CentOS family sometimes you need to add `:Z`
        # .e.g `/var/run/knot/:/var/run/knot/:Z`
        - /usr/lib/x86_64-linux-gnu/:/usr/lib/x86_64-linux-gnu/
        - /etc/knot/:/etc/knot/
        - /var/run/knot/:/var/run/knot/
        - /var/lib/knot/:/var/lib/knot/
        - /restknot-data/:/restknot-data/
